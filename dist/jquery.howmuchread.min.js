/*! howmuchread - v0.0.1 - 2015-06-03
* https://github.com/hakatashi/howmuchread
* Copyright (c) 2015 ; Licensed MIT */
!function(a){function b(b,c){for(var e,f,g=0,h=d(b),i=0;i<h.length;i++)if(g+=h[i].nodeValue.length,g>c){e=h[i],f=c-g+h[i].nodeValue.length;break}if(!e)return!1;var j=e.nodeValue;return a(e).replaceWith([document.createTextNode(j.slice(0,f)),a("<span/>",{id:"howmuchread-wrapper",text:j.substr(f,1)}),document.createTextNode(j.slice(f+1))]),!0}function c(b){b.find("span#howmuchread-wrapper").each(function(){var b=this.previousSibling,c=this.nextSibling,d="";b&&3===b.nodeType&&(d+=b.nodeValue,a(b).remove()),d+=a(this).text(),c&&3===c.nodeType&&(d+=c.nodeValue,a(c).remove()),a(this).replaceWith(document.createTextNode(d))})}function d(b){var c=[];return b.contents().each(function(){1===this.nodeType?c=c.concat(d(a(this))):3===this.nodeType&&c.push(this)}),c}function e(){var b,c,d,e,f=a(this).css("writing-mode")||a(this).css("-webkit-writing-mode")||a(this).css("-ms-writing-mode")||a(this).css("-moz-writing-mode")||a(this).get(0).style.writingMode||a(this).get(0).style.msWritingMode;return"horizontal-tb"===f||"lr-tb"===f||"rl-tb"===f?(b=!1,c=!0,d=!0,e="rtl"===a(this).css("direction")||"rl-tb"===f):(b=!0,c=!1,d="sideways-left"===a(this).css("text-orientation")?"rtl"===a(this).css("direction"):"rtl"!==a(this).css("direction"),e=void 0===f||"vertical-rl"===f||"tb"===f||"tb-rl"===f),{vertical:b,horizontal:c,ttb:d,rtl:e}}a.fn.howmuchread=function(){function f(a,b){for(var c=0,d=a;c!==d;){var e=Math.floor((c+d)/2),f=b(e);f?d=e:c=e+1}return c}var g=a(this),h=d(g),i=g.offset();i.right=a(document).width()-i.left-g.width(),i.bottom=a(document).height()-i.top-g.height();var j=e.call(this),k=0;a.each(h,function(a,b){k+=b.nodeValue.length});var l=f(k,function(d){var e,f=0;do f++,b(g,d),e=a("span#howmuchread-wrapper").offset(),e.right=a(document).width()-e.left-a("span#howmuchread-wrapper").width(),e.bottom=a(document).height()-e.top-a("span#howmuchread-wrapper").height(),c(g);while("undefined"==typeof e&&5>f);return j.horizontal?j.ttb?e.top>i.top?!0:!1:e.bottom<i.bottom?!0:!1:j.rtl?e.right>i.right?!0:!1:e.left<i.left?!0:!1});return l},a.fn.readafter=function(d){var e=a(this),f=e.offset();b(e,d);var g=a("span#howmuchread-wrapper").offset();return c(e),e.scrollTop(e.scrollTop()+g.top-f.top)}}(jQuery);